<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Timesheets</title>

  <!-- KOMPONENT NAGŁÓWKA -->
  <script>
     class HeaderComponent extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({ mode: 'open' });
      this.shadowRoot.innerHTML = `
        <style>
          .header {
            background-color: #e0e0e0;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
          }
          .hamburger {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            width: 30px;
            height: 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            box-sizing: border-box;
          }
          .hamburger div {
            width: 30px;
            height: 3px;
            background-color: #0078d7;
            border-radius: 5px;
          }
        </style>
        <div class="header">
          <a href="MainPage.html" style="text-decoration: none; color: black;">
            <span style="font-size: 24px; cursor: pointer;">&#8592;</span>
          </a>
          <span style="font-size: 20px; font-weight: bold;">My Timesheets</span>
          <button class="hamburger">
            <div></div>
            <div></div>
            <div></div>
          </button>
        </div>
      `;
    
  }
    }

    class FooterComponent extends HTMLElement {
      constructor() {
        super();
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.innerHTML = `
          <style>
            .footer {
              background-color: #e0e0e0;
              height: 60px;
              position: fixed;
              bottom: 0;
              width: 100%;
              display: flex;
              justify-content: center;
              align-items: center;
              box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.1);
            }
          </style>
          <div class="footer">
            <p>&copy; 2023 Your Company</p>
          </div>
        `;
      }
    }

    customElements.define('header-component', HeaderComponent);
    customElements.define('footer-component', FooterComponent);
    
    function navigateToEdit(button) {
      const tile = button.closest('.tile');
      const projectName = tile.dataset.project;
      const projectDate = tile.dataset.date;
      const url = `TimesheetsEdit.html?date=${encodeURIComponent(projectDate)}&project=${encodeURIComponent(projectName)}`;
      window.location.href = url;
    }

  </script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      overflow-y: scroll;
    }

    .container {
      padding: 40px 15px 80px 15px;
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    /* -------------------- STYLING FILTRÓW -------------------- */
    .filter-section {
      display: flex;
      flex-direction: column;
      gap: px;
    }

    /* Oddzielanie sekcji kreską (opcjonalnie można usunąć <hr> jeśli niepotrzebne) */
    .filters-separator {
      border: none;
      border-top: 1px solid #ccc;
      margin: 10px 0;
    }

    /* Sekcja z chipami statusu (możliwy wielokrotny wybór) */
    .status-filters {
      display: flex;
      flex-wrap: nowrap; 
      gap: 10px;
      align-items: center;
      overflow-x: auto; 
      padding-bottom: 5px;
    }

    /* Sekcja z chipami dat (pojedynczy wybór) */
    .date-filters {
      display: flex;
      flex-wrap: nowrap; 
      gap: 10px;
      align-items: center;
      overflow-x: auto; 
      padding-bottom: 5px;
    }

    .chip {
      flex-shrink: 0;
      display: inline-block;
      padding: 10px 20px;
      border: 1px solid #ddd;
      border-radius: 20px;
      background-color: #f5f5f5;
      font-size: 14px;
      color: #333;
      cursor: pointer;
      white-space: nowrap;
    }
    .chip.active {
      background-color: #0078d7;
      color: white;
      border-color: #005bb5;
    }
    .chip:hover {
      background-color: #e0e0e0;
    }

    /* Pola custom date range -> responsywny wygląd */
    .custom-date-range {
      display: none; 
      gap: 10px;
      flex-wrap: wrap; /* przenoszą się w dół na wąskich ekranach */
      align-items: center;
    }
    .custom-date-range label {
      white-space: nowrap;
    }
    .custom-date-range input[type="date"] {
      padding: 5px;
      font-size: 14px;
      min-width: 120px;
    }

    /* Sekcja globalnego filtra i przycisku Clear filters */
    .global-filter-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap; /* na wąskich ekranach przeskoczy button niżej */
    }
    #global-filter {
      flex: 1;          /* zajmuje dostępne miejsce */
      min-width: 200px; /* minimalna szerokość */
      padding: 8px;
      font-size: 14px;
    }

    .clear-filters-btn {
      background-color: #0078d7;
      color: white;
      border: none;
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 5px;
      cursor: pointer;
    }
    .clear-filters-btn:hover {
      background-color: #005bb5;
    }

    .tile {
      background-color: #ffffff;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 15px;
      display: grid;
      grid-template-columns: 30% auto 40px; /* Trzy kolumny: Project, Status, Button */
      column-gap: 15px; /* Odstęp między kolumnami */
      align-items: center; /* Wyrównanie elementów w pionie */
    }

    /* Pierwsza kolumna: Project Name i Date */
    .tile-content {
      display: flex;
      flex-direction: column; /* Ustawienie elementów w kolumnie */
    }

    .project-date {
      font-size: 16px;
      font-weight: bold;
      color: #333;
    }

    .project-name {
      font-size: 14px;
      font-weight: normal;
      color: #666;
      margin-top: 5px;
    }

    /* Druga kolumna: Status chip */
    .status-chip {
      display: inline-block;
      background-color: #28a745; /* Default green */
      color: white;
      font-size: 14px;
      padding: 7px 15px;
      border-radius: 15px;
      text-align: center;
      justify-self: start; /* Wyrównanie do lewej strony */
      width: 120px; /* Jednolita długość dla wszystkich chipów */
    }

    .status-chip.approved {
      background-color: #6ea96e; /* Stonowany zielony dla Approved */
    }

    .status-chip.submitted {
      background-color: #6c91d5; /* Stonowany niebieski dla Submitted */
    }

    .status-chip.draft {
      background-color: #e8d36e; /* Stonowany żółty dla Draft */
      color: black; /* Ciemny tekst dla lepszej widoczności */
    }

    /* Trzecia kolumna: Przycisk */
    .edit-button {
      background-color: transparent;
      border: none;
      color: #0078d7;
      font-size: 16px;
      cursor: pointer;
      width: 40px; /* Ustawiona szerokość */
      height: 40px; /* Ustawiona wysokość */
      display: flex;
      align-items: center;
      justify-content: center;
      justify-self: end; /* Wyrównanie do prawej strony */
    }

    .edit-button:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header-component></header-component>

  <div class="container">
    <!-- Sekcja filtrów -->
    <div class="filter-section">

      <!-- 1. Filtry statusu (wielokrotny wybór) -->
      <div class="status-filters">
        <div class="chip" data-value="Draft"     onclick="toggleStatus(this)">Draft</div>
        <div class="chip" data-value="Submitted" onclick="toggleStatus(this)">Submitted</div>
        <div class="chip" data-value="Approved"  onclick="toggleStatus(this)">Approved</div>
      </div>

      <hr class="filters-separator" />

      <!-- 2. Filtry dat (pojedynczy wybór) -->
      <div class="date-filters">
        <div class="chip" data-value="today"      onclick="toggleDate(this)">Today</div>
        <div class="chip" data-value="this-week"  onclick="toggleDate(this)">This Week</div>
        <div class="chip" data-value="this-month" onclick="toggleDate(this)">This Month</div>
        <div class="chip" data-value="this-year"  onclick="toggleDate(this)">This Year</div>
        <div class="chip" data-value="custom"     onclick="toggleDate(this)">Custom</div>
      </div>

      <!-- Pola "From" / "To" - widoczne tylko przy "custom" -->
      <div class="custom-date-range" id="custom-date-range">
        <label>From:</label>
        <input type="date" id="custom-from" onchange="filterTiles()" />
        <label>To:</label>
        <input type="date" id="custom-to" onchange="filterTiles()" />
      </div>

      <hr class="filters-separator" />

      <!-- 3. Globalny filtr tekstowy + przycisk Clear filters w jednej linii -->
      <div class="global-filter-row">
        <input
          type="text"
          id="global-filter"
          placeholder="Search (project, date, status)..."
          oninput="filterTiles()"
        />
        <button class="clear-filters-btn" onclick="resetFilters()">Clear filters</button>
      </div>
    </div>

    <!-- Lista kafelków -->
    <div id="tiles">
      <!-- 
        Każdy kafelek ma:
          data-project="..."  (np. "Project Alpha")
          data-status="..."   (np. "Draft")
          data-date="YYYY-MM-DD" (np. "2024-12-27")
        aby ułatwić filtrowanie w JS
      -->
      <div class="tile" data-project="Project Alpha" data-status="Draft" data-date="2024-12-27">
        <div class="tile-content">
          <span class="project-date">2024-12-27</span>
          <span class="project-name">Project Alpha</span>
        </div>
        <span class="status-chip draft">Draft</span>
        <button class="edit-button" onClick="navigateToEdit(this)">✏️</button>
      </div>

      <div class="tile" data-project="Project Beta" data-status="Submitted" data-date="2024-12-27">
        <div class="tile-content">
          <span class="project-date">2024-12-27</span>
          <span class="project-name">Project Beta</span>
        </div>
        <span class="status-chip submitted">Submitted</span>
        <button class="edit-button" onClick="navigateToEdit(this)">✏️</button>
      </div>

      <div class="tile" data-project="Project Gamma" data-status="Approved" data-date="2024-12-24">
        <div class="tile-content">
          <span class="project-date">2024-12-24</span>
          <span class="project-name">Project Gamma</span>
        </div>
        <span class="status-chip approved">Approved</span>
        <button class="edit-button" onClick="navigateToEdit(this)">✏️</button>
      </div>

      <div class="tile" data-project="Project Delta" data-status="Draft" data-date="2024-12-20">
        <div class="tile-content">
          <span class="project-date">2024-12-20</span>
          <span class="project-name">Project Delta</span>
        </div>
        <span class="status-chip draft">Draft</span>
        <button class="edit-button" onClick="navigateToEdit(this)">✏️</button>
      </div>

      <div class="tile" data-project="Project Epsilon" data-status="Submitted" data-date="2024-12-01">
        <div class="tile-content">
          <span class="project-date">2024-12-01</span>
          <span class="project-name">Project Epsilon</span>
        </div>
        <span class="status-chip submitted">Submitted</span>
        <button class="edit-button" onClick="navigateToEdit(this)">✏️</button>
      </div>

      <div class="tile" data-project="Project Zeta" data-status="Approved" data-date="2024-11-15">
        <div class="tile-content">
          <span class="project-date">2024-11-15</span>
          <span class="project-name">Project Zeta</span>
        </div>
        <span class="status-chip approved">Approved</span>
        <button class="edit-button" onClick="navigateToEdit(this)">✏️</button>
      </div>
    </div>
  </div>

  <footer-component></footer-component>

  <script>
    // Zmienna do przechowywania WYBRANYCH statusów (może być wiele).
    let selectedStatuses = [];

    // Zmienna do przechowywania WYBRANEGO zakresu dat (today / this-week / ... / custom).
    let selectedDateRange = "";

    // Toggle wielokrotny dla statusów
    function toggleStatus(element) {
      const statusValue = element.getAttribute("data-value");
      const isActive = element.classList.contains("active");

      if (isActive) {
        // Jeśli był aktywny, usuwamy z tablicy
        element.classList.remove("active");
        selectedStatuses = selectedStatuses.filter(st => st !== statusValue);
      } else {
        // Jeśli nie był aktywny, dodajemy do tablicy
        element.classList.add("active");
        selectedStatuses.push(statusValue);
      }

      filterTiles();
    }

    // Toggle jednorazowy dla zakresu dat
    function toggleDate(element) {
      const dateValue = element.getAttribute("data-value");
      const isActive = element.classList.contains("active");

      // Zdejmij 'active' z wszystkich chipów w .date-filters
      document.querySelectorAll(".date-filters .chip").forEach(chip => {
        chip.classList.remove("active");
      });
      // Ukryj sekcję custom date-range
      document.getElementById("custom-date-range").style.display = "none";

      // Jeśli był aktywny -> nic nie wybrane
      if (isActive) {
        selectedDateRange = "";
      } else {
        // Ustawiamy chip na active
        element.classList.add("active");
        selectedDateRange = dateValue;

        // Jeżeli wybrano "custom", to pokaż pola "From" i "To"
        if (dateValue === "custom") {
          document.getElementById("custom-date-range").style.display = "flex";
        }
      }

      filterTiles();
    }

    /**
     * Główna funkcja filtrująca kafelki.
     * - Wybór statusów (selectedStatuses[])
     * - Zakres dat (selectedDateRange)
     * - Globalny filtr tekstowy (#global-filter) -> wyszukuje w: project, status, date
     */
    function filterTiles() {
      // Globalny tekst do wyszukania
      const globalInput = document.getElementById("global-filter").value.toLowerCase();

      // Pola custom range
      const fromInput = document.getElementById("custom-from").value; 
      const toInput   = document.getElementById("custom-to").value;   

      // Przygotuj wartości dat (today, this-week, itp.)
      const now = new Date();
      let startRange = null;
      let endRange = null;

      switch (selectedDateRange) {
        case "today":
          startRange = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          endRange   = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);
          break;
        case "this-week":
          const dayOfWeek = now.getDay(); 
          const mondayOffset = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
          startRange = new Date(
            now.getFullYear(),
            now.getMonth(),
            now.getDate() - mondayOffset
          );
          endRange = new Date(
            startRange.getFullYear(),
            startRange.getMonth(),
            startRange.getDate() + 6,
            23, 59, 59
          );
          break;
        case "this-month":
          startRange = new Date(now.getFullYear(), now.getMonth(), 1);
          endRange   = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);
          break;
        case "this-year":
          startRange = new Date(now.getFullYear(), 0, 1);
          endRange   = new Date(now.getFullYear(), 11, 31, 23, 59, 59);
          break;
        case "custom":
          // skorzystamy z "fromInput" i "toInput"
          break;
        default:
          // brak filtra daty
          break;
      }

      document.querySelectorAll(".tile").forEach(tile => {
        const tileProject = tile.dataset.project.toLowerCase(); 
        const tileStatus  = tile.dataset.status.toLowerCase();   
        const tileDateStr = tile.dataset.date;                   // 'YYYY-MM-DD'

        // 1. Filtr statusu
        let matchStatus = true;
        if (selectedStatuses.length > 0) {
          // tileStatus (np. 'draft') musi być w tablicy selectedStatuses (która zawiera np. 'Draft')
          // ALE pamiętajmy, że tileStatus mamy zrobiony .toLowerCase()
          // a w tablicy selectedStatuses mamy oryginalne wartości (np. "Draft")
          // Więc zróbmy comparision case-insensitive:
          const statusesLower = selectedStatuses.map(s => s.toLowerCase());
          matchStatus = statusesLower.includes(tileStatus);
        }

        // 2. Filtr dat
        let matchDate = true;
        if (selectedDateRange) {
          const tileDateObj = new Date(tileDateStr);

          if (selectedDateRange === "custom") {
            let fromDate = fromInput ? new Date(fromInput) : null;
            let toDate   = toInput   ? new Date(toInput)   : null;
            if (fromDate && tileDateObj < fromDate) {
              matchDate = false;
            }
            if (toDate) {
              let toDateEndOfDay = new Date(
                toDate.getFullYear(),
                toDate.getMonth(),
                toDate.getDate(),
                23, 59, 59
              );
              if (tileDateObj > toDateEndOfDay) {
                matchDate = false;
              }
            }
          } else {
            if (startRange && tileDateObj < startRange) matchDate = false;
            if (endRange && tileDateObj > endRange) matchDate = false;
          }
        }

        // 3. Globalny filtr tekstowy - szukamy w tileProject, tileStatus, tileDateStr
        let matchGlobal = true;
        if (globalInput) {
          // Szukamy substringu w (project / status / dacie)
          // tileDateStr -> np. "2024-12-27" -> sprawdzamy, czy w nim jest fragment globalInput
          // (np. "2024", "12", "27", itp.)
          const tileDateLower = tileDateStr.toLowerCase(); 
          if (
            !tileProject.includes(globalInput) &&
            !tileStatus.includes(globalInput) &&
            !tileDateLower.includes(globalInput)
          ) {
            matchGlobal = false;
          }
        }

        // Pokazujemy kafelek tylko, jeżeli wszystkie warunki są spełnione
        if (matchStatus && matchDate && matchGlobal) {
          tile.style.display = "";
        } else {
          tile.style.display = "none";
        }
      });
    }

    // Reset wszystkich filtrów
    function resetFilters() {
      // Czyścimy tablicę statusów i chipy
      selectedStatuses = [];
      document.querySelectorAll(".status-filters .chip").forEach(chip => {
        chip.classList.remove("active");
      });

      // Czyścimy date range i chipy
      selectedDateRange = "";
      document.querySelectorAll(".date-filters .chip").forEach(chip => {
        chip.classList.remove("active");
      });
      // Ukryj sekcję custom
      document.getElementById("custom-date-range").style.display = "none";
      document.getElementById("custom-from").value = "";
      document.getElementById("custom-to").value   = "";

      // Czyścimy pole globalnego wyszukiwania
      document.getElementById("global-filter").value = "";

      // Ponownie filtrujemy (bez żadnych ograniczeń)
      filterTiles();
    }
  </script>
</body>
</html>
